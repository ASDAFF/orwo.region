# orwo.region
Original Works (Isaev): Region – свой контент на алиасах (orwo.region)
---
### Установка
---
- Установка происхоит, как и с обычным модулем.
- Закидываем в /bitrix/modules или /local/modules/ и после этого устанавливаем в ```/bitrix/admin/partner_modules.php?lang=ru```
---
### Возможности
---
- Каждое свойство инфоблока регионов становится плейсхолдером по принципу

 ```код_свойства =  {код_свойства} => Значение свойства```
<p>Создаем новый инфоблок. У элементов инфоблока название - > домен (test.example.ru), а свойства это плейсхолдеры<p> 
<img src="https://camo.githubusercontent.com/ac33711212dde48d25cd8c53674071fa0aee2901/68747470733a2f2f692e6962622e636f2f364871714a506b2f70726f702e706e67">


 Т.е для того, чтобы создать новый плейсходер для замены достаточно добавить новое свойство.
 (Работает с свойстами типа строка. И они не должны быть множественными)

- Возможность привязки отдельных элементов к элементам инфоблока. Можно например в фильтре вывода товаров ограничить регионы
- Автозамена robots.txt и sitemap.xml. После установки в корне появятся два файла: 
  * robots.php;
  * sitemap.php;
  
Данные файлы служат для автоматической подмены оригинальных файлов. Для их работы нужно в .htaccess прописать:

```
RewriteRule ^robots.txt$ /robots.php [L]
RewriteRule ^sitemap.xml$ /sitemap.php [L]
```
- Возможность использовать везде без внесения лишнего кода. Для подмены контента используется "OnEndBufferContent" событие. Т.е можно написать в описании товара или раздела {in_city} и контент там подменится

:warning: В режиме редактирования и если вы находитесь в дериктории /bitrix/... данные не подменяются, для того чтоб вы видели плейсхолдеры.

- GeoIP. Наверное все уже видели магию в виде "*Название города* - это ваш город?". 
Стандартными битрикс возможности это реализовано в функции \Orwo\Region\Init::getRegionIP();
Данная функция получает элемент региона исходя из IP пользователя. Если не удалось найти, то функция получает ответ false.

---
### Функции и переменные:
---
* ```\Orwo\Region\Init::getRegions(true);``` - Получить массив свойств текущего регион
* ```\Orwo\Region\Init::getRegions();``` - Получить массив свойств всех регионов
* Подмена плейсхолдеров в строке
 ```php
 $str = 'Купить {in_city} яблоки';
 $str = \Orwo\Region\Init::replaceStrRegion($str); 
 // $str = 'Купить в Москве яблоки'
 ```
 * ```\Orwo\Region\Init::getRegionIP();``` - Получить регион по IP пользователя
---
### Раньше было лучше!
***
- В: Где мои $GLOBALS['city']?
- О: Если очень хочется, то в init.php или header.php можно подключить:
```php
global $mainRegion, $arRegions;
$mainRegion = \Orwo\Region\Init::getRegions(true);
$arRegions = \Orwo\Region\Init::getRegions();
```
И так как используется событие "OnEndBufferContent", то можно просто в любом месте писать плейсхолдер {city}
[Почему GLOBALS - зло](https://ru.stackoverflow.com/questions/510910/%D0%9F%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D0%B3%D0%BB%D0%BE%D0%B1%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D1%8D%D1%82%D0%BE-%D0%B7%D0%BB%D0%BE-%D0%B0-%D0%BF%D0%BE%D0%BB%D1%8F-%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%B0-%D0%BD%D0%B5%D1%82)

***
- В: Почему {city}, а не #city#?
- О: [Стараюсь соответсвовать стандартам PSR](https://www.php-fig.org/psr/psr-3/)

***
- В: Ну вот раньше я мог все что нужно прописать в init.php вместе с алиасами
- О: Если нужны какие-то кстомные функции или изменить список плейсхолдеров или подкинуть в регион свою переменную, создан специальный > класс "\Orwo\Region\Custom". 
В нем уже есть 3 кастомные функции для примера. 
  * ```patternEvent``` - получает сформированные паттерны перед отправкой на преобразование. Можно сказать - событие.
  * ```regionEvent``` - тоже самое, но с регионами.
  * ```exampleCustomFunction``` - просто пример не используемый в Init
---


